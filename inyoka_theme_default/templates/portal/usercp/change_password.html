{#
    portal/usercp/change_password.html
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    This page dispalys a form where the user can change his password.

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}

{% extends 'portal/usercp/overall.html' %}
{% import 'macros.html' as macros %}

{% block breadcrumb %}
  {{ super() }}

  {{ macros.breadcrumb_item(_('Change password'), href('portal', 'usercp', 'password'))}}
{% endblock %}
{% set selected = 'password' %}

{% block content %}
  <h3>{% trans %}Change password{% endtrans %}</h3>
  {% call macros.outer_form(csrf_token(), form, manually_rendered=True,submit_label="Change password") %}
    <p>{% trans %}
      You can change your password with this form. For security reasons, you need to enter your old password.
    {% endtrans %}</p>
    {{ macros.inner_form(form, ['old_password', 'new_password', 'new_password_confirm']) }}
    <p>
      {% if random_pw %}
        {% trans %}Generated password:{% endtrans %}
        <code id="random_password">{{ random_pw }}</code> |
      {% endif %}
      <a href="{{ href('portal', 'usercp', 'password', random='true') }}" id="random_password_link">
        {% if random_pw %}
          {% trans %}Generate a new one{% endtrans %}
        {% else %}
          {% trans %}Generate a random password{% endtrans %}
        {% endif %}
      </a>
    </p>
  {% endcall %}
{% endblock %}

{% block additional_scripts %}
  {{ super() }}
  <script type="text/javascript">
  /*<![CDATA[*/
    (function () {
      $('#random_password_link')
        .click(function() {
          $.getJSON('/?__service__=portal.get_random_password', function(data) {
            $('#id_new_password')
              .attr('value', data.password);
            $('#id_new_password_confirm')
              .attr('value', data.password);
            if ( ! $('#random_password').length )
            {
            $('#random_password_link')
              .html('{% trans %}Generate a new one{% endtrans %}')
              .before('{% trans %}Generated password:{% endtrans %} <code id="random_password">' +
                      '</code> | ');
            }
            $('#random_password').html(data.password);
          })
          return false;
        });
        })();
  /*]]> */
  </script>
{% endblock %}
